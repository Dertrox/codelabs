<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bienestar ‚Ä¢ Obesidad</title>
  <meta name="description" content="Recursos amables sobre obesidad: videos, respiraci√≥n 4-7-8, calculadoras, registro de peso y cuestionario de bienestar." />
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' x2='1'%3E%3Cstop stop-color='%23fda4af'/%3E%3Cstop stop-color='%23fde68a' offset='1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='44' fill='url(%23g)'/%3E%3C/svg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    html,body{height:100%;scroll-behavior:smooth}
    /* Fondo pastel claro (sin transparencias) */
    .bg-pastel{
      background: linear-gradient(180deg,#fff 0%, #fdf7f8 40%, #f7fbff 100%);
    }
    ::selection{background:#fda4af;color:#fff}
    /* Tarjeta opaca */
    .card{background:#ffffff}
    .dark .card{background:#121212}
    .shadow-soft{box-shadow:0 10px 20px rgba(0,0,0,.06)}
    /* Texto m√°s saturado en modo claro */
    .t-body{color:#1f2937}       /* neutral-800 */
    .t-muted{color:#374151}      /* neutral-700 */
    .t-soft{color:#6b7280}       /* neutral-500 */
    /* Respiraci√≥n */
    #breathBall{transition:transform .8s ease-in-out;background:radial-gradient(circle at 30% 30%, #fef2f2, #fecdd3)}
    /* Mini barras */
    .mini-bar{height:6px;border-radius:9999px;background:rgba(0,0,0,.08)}
    .mini-fill{height:100%;border-radius:9999px;background:#fda4af}
    /* Bot√≥n flotante */
    .fab{position:fixed;right:16px;bottom:16px}
  </style>
</head>
<body class="antialiased bg-pastel">
  <!-- Sonido ambiente (desbloqueo por clic) -->
  <audio id="ambAudio" loop preload="none" crossOrigin="anonymous" playsinline></audio>

  <div class="min-h-screen text-neutral-900 dark:text-neutral-100 p-5 md:p-10">
    <div class="mx-auto max-w-6xl space-y-6" id="top">

      <!-- Topbar -->
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <span class="rounded-full border px-3 py-1 bg-white">üåø Bienestar</span>
          <span class="rounded-full border px-3 py-1 bg-white">Obesidad</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="peaceBtn" class="rounded-full border px-3 py-2 text-sm hover:bg-rose-50">üîà Paz OFF</button>
          <input id="vol" type="range" min="0" max="1" step="0.05" value="0.25" class="w-24 accent-rose-400" title="Volumen">
          <button id="themeBtn" class="rounded-full border px-3 py-2 text-sm hover:bg-rose-50">‚òÄÔ∏è Claro</button>
        </div>
      </div>

      <!-- HERO -->
      <div class="rounded-3xl card backdrop-blur border border-neutral-200 shadow-soft p-6 md:p-10">
        <div class="grid grid-cols-1 gap-6 md:grid-cols-5">
          <div class="md:col-span-3">
            <h1 class="text-4xl md:text-5xl font-serif leading-tight t-body">El primer paso<br>hacia tu bienestar</h1>
            <p class="mt-4 max-w-prose t-muted">
              Tratamiento de obesidad con enfoque integral: h√°bitos sostenibles, apoyo emocional y pasos diarios.
            </p>
            <div class="mt-6 flex gap-3">
              <a href="#pasos" class="inline-flex items-center gap-2 rounded-full bg-rose-400 px-5 py-2 text-white shadow hover:bg-rose-500">Empezar ‚Üí</a>
              <a href="#respira" class="inline-flex items-center gap-2 rounded-full border px-5 py-2 hover:bg-rose-50">Respirar</a>
            </div>
          </div>
          <div class="md:col-span-2">
            <div class="rounded-2xl border card p-6 text-center">
              <svg viewBox="0 0 120 80" class="w-full h-40">
                <rect x="8" y="8" width="104" height="64" rx="12" fill="#fff" stroke="#fecaca"/>
                <circle cx="60" cy="40" r="14" fill="#fee2e2">
                  <animate attributeName="r" values="11;15;11" dur="4s" repeatCount="indefinite"/>
                </circle>
                <text x="60" y="72" text-anchor="middle" fill="#6b7280" font-size="7">Relaja y respira</text>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Objetivo / Datos / Apoyo -->
      <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
        <div class="rounded-3xl card border p-6 shadow-soft">
          <h2 class="text-2xl font-semibold t-body">Objetivo</h2>
          <p class="mt-3 t-muted">Promover bienestar integral y prevenir complicaciones con educaci√≥n clara y apoyo psicol√≥gico.</p>
        </div>
        <div class="rounded-3xl card border p-6 shadow-soft">
          <h2 class="text-2xl font-semibold t-body">Datos epidemiol√≥gicos</h2>
          <p class="mt-3 t-muted">La obesidad es frecuente y aumenta el riesgo de DM2, HTA y SAHOS. El entorno importa.</p>
        </div>
        <div class="rounded-3xl card border p-6 shadow-soft">
          <h2 class="text-2xl font-semibold t-body">Apoyo psicol√≥gico</h2>
          <p class="mt-3 t-muted">Manejo de hambre emocional, autocr√≠tica y prevenci√≥n de reca√≠das con metas peque√±as.</p>
        </div>
      </div>

      <!-- Calculadoras -->
      <div class="rounded-3xl card border p-6 shadow-soft">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="md:col-span-2">
            <h3 class="text-2xl font-semibold t-body">Calculadora de IMC</h3>
            <p class="text-sm t-soft">Orientativa; no sustituye valoraci√≥n cl√≠nica.</p>
            <div class="mt-4 grid grid-cols-2 gap-4 max-w-md">
              <label class="text-sm">Peso (kg)
                <input id="kg" type="number" value="70" class="mt-1 w-full rounded-xl border px-3 py-2">
              </label>
              <label class="text-sm">Estatura (cm)
                <input id="cm" type="number" value="170" class="mt-1 w-full rounded-xl border px-3 py-2">
              </label>
            </div>
            <p class="mt-3 t-body"><strong>IMC:</strong> <span id="bmiVal" class="font-semibold">‚Äî</span> ‚Äî <span id="bmiTxt">‚Äî</span></p>
          </div>
          <div>
            <h3 class="text-2xl font-semibold t-body">TDEE (Gasto diario)</h3>
            <div class="mt-3 grid grid-cols-2 gap-3">
              <label class="text-sm">Sexo
                <select id="sexo" class="mt-1 w-full rounded-xl border px-3 py-2">
                  <option value="F">Femenino</option><option value="M">Masculino</option>
                </select>
              </label>
              <label class="text-sm">Edad
                <input id="edad" type="number" value="30" class="mt-1 w-full rounded-xl border px-3 py-2">
              </label>
              <label class="col-span-2 text-sm">Actividad
                <select id="act" class="mt-1 w-full rounded-xl border px-3 py-2">
                  <option value="1.2">Sedentario (√ó1.2)</option>
                  <option value="1.375" selected>Ligero (√ó1.375)</option>
                  <option value="1.55">Moderado (√ó1.55)</option>
                  <option value="1.725">Alto (√ó1.725)</option>
                  <option value="1.9">Muy alto (√ó1.9)</option>
                </select>
              </label>
            </div>
            <p class="mt-3 text-sm t-body">BMR ‚âà <b id="bmr">‚Äî</b> kcal ¬∑ TDEE ‚âà <b id="tdee">‚Äî</b> kcal/d√≠a</p>
          </div>
        </div>
      </div>

      <!-- Respiraci√≥n -->
      <div id="respira" class="rounded-3xl card border p-6 shadow-soft">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
          <div class="md:col-span-2">
            <h3 class="text-2xl font-semibold t-body">Respiraci√≥n 4‚Äì7‚Äì8</h3>
            <p class="text-sm t-soft">Ejercicio para calmar. Sigue el c√≠rculo.</p>
            <div class="mt-4 flex items-center gap-5">
              <div class="relative h-28 w-28">
                <div id="breathBall" class="absolute inset-0 rounded-full"></div>
                <div class="absolute inset-3 rounded-full card border"></div>
              </div>
              <div>
                <p id="breathPhase" class="text-xl font-semibold t-body">Inhala</p>
                <p class="t-muted">Cuenta: <span id="breathCount">4</span>s</p>
                <p class="text-xs t-soft mt-1">3‚Äì5 ciclos para relajar.</p>
              </div>
            </div>
          </div>
          <div class="md:col-span-1">
            <div class="rounded-2xl border card p-4 text-center">
              <svg viewBox="0 0 120 60" class="w-full h-32">
                <rect x="10" y="12" width="100" height="36" rx="8" fill="#fff" stroke="#fecaca"/>
                <circle cx="35" cy="30" r="8" fill="#fecaca">
                  <animate attributeName="r" values="7;9;7" dur="2.6s" repeatCount="indefinite"/>
                </circle>
                <circle cx="85" cy="30" r="8" fill="#bae6fd">
                  <animate attributeName="r" values="8;6;8" dur="3s" repeatCount="indefinite"/>
                </circle>
              </svg>
              <p class="text-xs t-soft">Activa ¬´Paz ON¬ª üåø</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Pasos -->
      <div id="pasos" class="rounded-3xl card border p-6 shadow-soft">
        <div class="flex items-center justify-between">
          <h3 class="text-2xl font-semibold t-body">C√≥mo empezar tu tratamiento</h3>
          <div class="flex gap-2">
            <button id="prevStep" class="rounded-full border px-3 py-1 hover:bg-rose-50">‚Üê</button>
            <button id="nextStep" class="rounded-full border px-3 py-1 hover:bg-rose-50">‚Üí</button>
          </div>
        </div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="md:col-span-2 rounded-2xl border card p-5">
            <h4 id="stepTitle" class="text-xl font-semibold t-body">1) Con√≥cete y define metas</h4>
            <ul id="stepList" class="mt-3 list-disc pl-5 space-y-2 t-muted"></ul>
          </div>
          <div class="md:col-span-1">
            <div class="rounded-2xl border card p-5">
              <p class="text-sm t-soft">Peque√±os pasos ‚Üí grandes cambios üí´</p>
              <div class="mt-3 mini-bar"><div class="mini-fill" style="width:40%"></div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Videos + Cuestionario -->
      <div class="rounded-3xl card border p-6 shadow-soft">
        <h3 class="text-2xl font-semibold t-body">Videos educativos</h3>
        <p class="text-sm t-soft">Mira los videos y luego responde el cuestionario de bienestar.</p>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="md:col-span-2">
            <div class="relative overflow-hidden rounded-2xl border card">
              <video id="mainVideo" controls playsinline preload="metadata" class="w-full aspect-video bg-black">
                <source id="mainSrc" src="" type="video/mp4">
              </video>
            </div>
            <div class="mt-2 flex items-center gap-3 text-sm">
              <span id="vTime" class="t-soft select-none">0:00 / 0:00</span>
              <input id="vSeek" type="range" min="0" max="100" value="0" class="flex-1 accent-rose-400"/>
              <a id="dlLink" class="rounded-full border px-3 py-1 hover:bg-rose-50" href="#" download>‚¨áÔ∏è Descargar</a>
              <button id="fsBtn" class="rounded-full border px-3 py-1 hover:bg-rose-50">‚õ∂ Pantalla completa</button>
            </div>
          </div>
          <div class="md:col-span-1">
            <div id="playlist" class="rounded-2xl border card p-2"></div>
          </div>
        </div>

        <div class="mt-4">
          <button id="openQuiz" class="rounded-full border px-4 py-2 hover:bg-rose-50">üìù Responder cuestionario</button>
          <div id="quizBox" class="hidden mt-3">
            <h4 class="text-xl font-semibold t-body">Cuestionario breve de bienestar emocional</h4>
            <p class="text-sm t-soft">√öltimas 2 semanas (0 Nunca ¬∑ 1 A veces ¬∑ 2 Frecuentemente ¬∑ 3 Casi siempre)</p>
            <div class="mt-2 mini-bar"><div id="quizProg" class="mini-fill" style="width:0%"></div></div>
            <div id="quizList" class="mt-3 space-y-3"></div>
            <div class="mt-4 flex items-center gap-3">
              <span id="quizResult" class="inline-flex items-center rounded-full px-3 py-1 text-sm bg-rose-50 text-rose-700">Resultado: 0 / 24 ‚Ä¢ nivel bajo</span>
              <button id="quizReset" class="rounded-full border px-3 py-1 hover:bg-rose-50">Reiniciar</button>
            </div>
            <div id="quizAdvice" class="mt-3 text-sm t-muted"></div>
          </div>
        </div>
      </div>

      <!-- Registro de peso + h√°bitos -->
      <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
        <div class="rounded-3xl card border p-6 md:col-span-2 shadow-soft">
          <h3 class="text-2xl font-semibold t-body">Registro de peso</h3>
          <div class="mt-3 flex flex-wrap items-end gap-3">
            <label class="text-sm">Fecha
              <input id="wDate" type="date" class="mt-1 rounded-xl border px-3 py-2">
            </label>
            <label class="text-sm">Peso (kg)
              <input id="wVal" type="number" class="mt-1 rounded-xl border px-3 py-2">
            </label>
            <button id="wAdd" class="rounded-xl border px-4 py-2 hover:bg-rose-50">Agregar</button>
          </div>
          <div class="mt-4">
            <canvas id="wChart" height="240" aria-label="Gr√°fico de peso"></canvas>
          </div>
        </div>
        <div class="rounded-3xl card border p-6 md:col-span-1 shadow-soft">
          <h3 class="text-2xl font-semibold t-body">Plan de h√°bitos (semana)</h3>
          <div id="habitsMeta" class="text-sm t-soft mt-1">0% completado</div>
          <div class="mt-2 mini-bar"><div id="habitsFill" class="mini-fill" style="width:0%"></div></div>
          <div id="habitsGrid" class="mt-3 grid grid-cols-8 gap-2 text-xs"></div>
        </div>
      </div>

      <div class="rounded-3xl card border p-4 text-center text-sm shadow-soft">
        <p>Redes: üìß contacto@bienestar.org ¬∑ üì± WhatsApp ¬∑ üì∏ Instagram ¬∑ üé• TikTok</p>
        <p class="mt-1 text-xs t-soft">Contenido informativo; no sustituye valoraci√≥n profesional.</p>
      </div>
    </div>
  </div>

  <a href="#top" class="fab rounded-full bg-rose-400 text-white px-4 py-3 shadow-lg hover:bg-rose-500" aria-label="Volver arriba">‚Üë</a>

  <script>
    /* ---------- Utiles ---------- */
    const LS=(k,v)=>v===undefined?JSON.parse(localStorage.getItem(k)||'null'):localStorage.setItem(k,JSON.stringify(v));

    /* ---------- Tema + audio ---------- */
    const themeBtn=document.getElementById('themeBtn');
    const peaceBtn=document.getElementById('peaceBtn');
    const vol=document.getElementById('vol');
    const amb=document.getElementById('ambAudio');
    // 2 pistas por si una falla
    const AMBIENTS=[
      "https://cdn.pixabay.com/download/audio/2021/09/16/audio_0b4d2f88f6.mp3?filename=forest-birds-ambient-116199.mp3",
      "https://cdn.pixabay.com/download/audio/2022/03/15/audio_73a27a3c8a.mp3?filename=calm-nature-ambient-110997.mp3"
    ];
    amb.src=AMBIENTS[0];

    const savedDark=LS('dark')??false;
    document.documentElement.classList.toggle('dark',savedDark);
    themeBtn.textContent=savedDark?'‚òæ Oscuro':'‚òÄÔ∏è Claro';
    themeBtn.onclick=()=>{const now=!document.documentElement.classList.contains('dark');document.documentElement.classList.toggle('dark',now);themeBtn.textContent=now?'‚òæ Oscuro':'‚òÄÔ∏è Claro';LS('dark',now);};

    const savedPeace=LS('peace')??false;
    const savedVol=LS('vol')??0.25; vol.value=savedVol; amb.volume=savedVol;
    peaceBtn.textContent=savedPeace?'üîä Paz ON':'üîà Paz OFF';

    // Desbloqueo por primer clic (algunas pol√≠ticas lo exigen)
    document.addEventListener('click',()=>{ if(LS('peace')) tryPlay(); },{once:true});
    function tryPlay(){
      amb.muted=false;
      amb.currentTime=0;
      amb.play().catch(()=>{}); // silenciar errores
    }

    if(savedPeace) tryPlay();
    peaceBtn.onclick=()=>{
      const turnOn=peaceBtn.textContent.includes('OFF');
      peaceBtn.textContent=turnOn?'üîä Paz ON':'üîà Paz OFF';
      LS('peace',turnOn);
      if(turnOn) tryPlay(); else amb.pause();
    };
    vol.oninput=e=>{amb.volume=+e.target.value;LS('vol',+e.target.value);};
    amb.addEventListener('error',()=>{ // cambiar a backup si falla
      const now=amb.src; const next=AMBIENTS.find(u=>u!==now); if(next){amb.src=next; if(LS('peace')) tryPlay();}
    });

    /* ---------- IMC / TDEE ---------- */
    const kg=document.getElementById('kg'), cm=document.getElementById('cm'), sexo=document.getElementById('sexo'), edad=document.getElementById('edad'), act=document.getElementById('act');
    const bmiVal=document.getElementById('bmiVal'), bmiTxt=document.getElementById('bmiTxt'), bmrEl=document.getElementById('bmr'), tdeeEl=document.getElementById('tdee');
    function updateCalcs(){const w=+kg.value||0,h=+cm.value||1,e=+edad.value||0,m=h/100,bmi=w/(m*m),b=Math.round(bmi*10)/10;bmiVal.textContent=isFinite(b)?b:'‚Äî';bmiTxt.textContent=!isFinite(b)?'‚Äî':b<18.5?'Bajo peso':b<25?'Normopeso':b<30?'Sobrepeso':b<35?'Obesidad I':b<40?'Obesidad II':'Obesidad III';const B=Math.round(sexo.value==='M'?(10*w+6.25*h-5*e+5):(10*w+6.25*h-5*e-161));const T=Math.round(B*(+act.value));bmrEl.textContent=isFinite(B)?B:'‚Äî';tdeeEl.textContent=isFinite(T)?T:'‚Äî';}
    [kg,cm,sexo,edad,act].forEach(el=>el.addEventListener('input',updateCalcs)); updateCalcs();

    /* ---------- Respiraci√≥n 4-7-8 ---------- */
    const ball=document.getElementById('breathBall'), phaseEl=document.getElementById('breathPhase'), countEl=document.getElementById('breathCount');
    const phases=[{label:'Inhala',sec:4,scale:1.22},{label:'Sost√©n',sec:7,scale:1.30},{label:'Exhala',sec:8,scale:.92}]; let p=0,s=phases[0].sec;
    function breathTick(){ if(s<=1){p=(p+1)%phases.length;s=phases[p].sec;} else s--; const ph=phases[p]; phaseEl.textContent=ph.label; countEl.textContent=s; ball.style.transform=`scale(${ph.scale})`; } setInterval(breathTick,1000);

    /* ---------- Pasos ---------- */
    const steps=[{title:"1) Con√≥cete y define metas",items:["Calcula IMC y cintura.","1 meta concreta (4‚Äì6 semanas).","Registra 3 d√≠as de base."]},{title:"2) Plan 80/20 + movimiento",items:["3 comidas + 1 colaci√≥n (prote√≠na/fibra).","Plato: 1/2 verduras, 1/4 prote√≠na, 1/4 carbo integral.","150‚Äì300 min/sem + 2x fuerza."]},{title:"3) Acompa√±amiento y seguimiento",items:["Apoyo psicol√≥gico.","Consulta si hay comorbilidades.","Revisiones semanales y ajustes amables."]}];
    let stepIdx=0; const stepTitle=document.getElementById('stepTitle'), stepList=document.getElementById('stepList');
    function renderStep(){ stepTitle.textContent=steps[stepIdx].title; stepList.innerHTML=steps[stepIdx].items.map(li=>`<li>${li}</li>`).join(''); }
    document.getElementById('prevStep').onclick=()=>{stepIdx=(stepIdx-1+steps.length)%steps.length;renderStep();};
    document.getElementById('nextStep').onclick=()=>{stepIdx=(stepIdx+1)%steps.length;renderStep();};
    renderStep();

    /* ---------- Videos + playlist (asegurar que TODOS reproducen) ---------- */
    const videos=[
      {src:'videos/la-obesidad.mp4?v=7', title:'La obesidad', desc:'Introducci√≥n general'},
      {src:'videos/que-es-la-obesidad.mp4?v=7', title:'¬øQu√© es la obesidad?', desc:'Conceptos clave'},
      {src:'videos/obesidad.mp4?v=7', title:'Obesidad (extra)', desc:'Recomendaciones'}
    ];
    const mainVideo=document.getElementById('mainVideo');
    const mainSrc=document.getElementById('mainSrc');
    const playlist=document.getElementById('playlist');
    const dlLink=document.getElementById('dlLink');
    const fsBtn=document.getElementById('fsBtn');
    const vTime=document.getElementById('vTime');
    const vSeek=document.getElementById('vSeek');
    let current=0, watched=LS('watched')||[];

    function fmtDur(sec){if(!isFinite(sec))return'--:--';const m=Math.floor(sec/60),s=Math.round(sec%60);return`${m}:${s.toString().padStart(2,'0')}`;}
    function setVideo(i){
      current=i;
      mainVideo.pause();
      mainSrc.src=videos[i].src;           // usar <source>
      mainVideo.load();                    // forzar recarga
      dlLink.href=videos[i].src;
      vTime.textContent='0:00 / 0:00'; vSeek.value=0;
      [...playlist.querySelectorAll('button')].forEach((b,idx)=> b.classList.toggle('ring-rose-300', idx===i));
      // Intento de reproducci√≥n autom√°tica tras clics del usuario
      mainVideo.play().catch(()=>{ /* si falla, el usuario puede darle play */ });
    }

    videos.forEach((v,idx)=>{
      const btn=document.createElement('button');
      btn.className='w-full text-left rounded-xl px-3 py-2 mb-2 border ring-1 ring-transparent hover:bg-rose-50';
      btn.innerHTML=`
        <div class="flex items-center justify-between">
          <span class="font-medium">${v.title}</span>
          <span class="text-xs t-soft" id="d${idx}">--:--</span>
        </div>
        <p class="text-xs t-soft flex items-center gap-1">${v.desc||''} <span id="ok${idx}" class="ml-1 ${watched.includes(v.src)?'':'hidden'}">‚úì</span></p>
      `;
      btn.onclick=()=>setVideo(idx);
      playlist.appendChild(btn);

      // calcular duraci√≥n
      const probe=document.createElement('video');
      probe.preload='metadata';
      probe.src=v.src;
      probe.onloadedmetadata=()=>{document.getElementById(`d${idx}`).textContent=fmtDur(probe.duration);probe.remove();};
    });
    setVideo(0);

    fsBtn.onclick=()=> mainVideo.requestFullscreen && mainVideo.requestFullscreen();
    mainVideo.addEventListener('loadedmetadata',()=>{vTime.textContent=`0:00 / ${fmtDur(mainVideo.duration)}`;});
    mainVideo.addEventListener('timeupdate',()=>{vTime.textContent=`${fmtDur(mainVideo.currentTime)} / ${fmtDur(mainVideo.duration)}`;vSeek.value=(mainVideo.currentTime/(mainVideo.duration||1))*100;});
    vSeek.addEventListener('input',e=>{mainVideo.currentTime=(+e.target.value/100)*(mainVideo.duration||0);});
    document.addEventListener('keydown',e=>{if(e.target.tagName.match(/INPUT|TEXTAREA|SELECT/))return;if(e.code==='Space'){e.preventDefault();mainVideo.paused?mainVideo.play():mainVideo.pause();}if(e.code==='ArrowRight'){mainVideo.currentTime+=5;}if(e.code==='ArrowLeft'){mainVideo.currentTime-=5;}});
    mainVideo.addEventListener('ended',()=>{const src=videos[current].src;if(!watched.includes(src)){watched.push(src);LS('watched',watched);document.getElementById(`ok${current}`).classList.remove('hidden');}document.getElementById('quizBox').classList.remove('hidden');});

    /* ---------- Quiz ---------- */
    const Qs=["Poco inter√©s o placer en hacer cosas","Sensaci√≥n de tristeza o decaimiento","Dificultad para dormir o dormir en exceso","Cansancio o poca energ√≠a","Cambios en el apetito","Sentirse mal consigo mismo/a","Dificultad para concentrarse","Inquietud o ansiedad"];
    const quizList=document.getElementById('quizList'), quizBox=document.getElementById('quizBox'), quizRes=document.getElementById('quizResult'), quizAdvice=document.getElementById('quizAdvice'), quizReset=document.getElementById('quizReset'), quizProg=document.getElementById('quizProg'); document.getElementById('openQuiz').onclick=()=>quizBox.classList.toggle('hidden');
    let answers=JSON.parse(localStorage.getItem('quiz-ans')||'[]'); if(!answers.length) answers=Array(Qs.length).fill(0);
    function updateQuiz(){const score=answers.reduce((a,b)=>a+b,0);let nivel='bajo',cls='bg-rose-50 text-rose-700';if(score>7&&score<=15){nivel='moderado';cls='bg-amber-50 text-amber-700';}if(score>15){nivel='alto';cls='bg-red-50 text-red-700';}quizRes.className=`inline-flex items-center rounded-full px-3 py-1 text-sm ${cls}`;quizRes.textContent=`Resultado: ${score} / 24 ‚Ä¢ nivel ${nivel}`;quizAdvice.innerHTML=nivel==='bajo'?'üíö Bien: mant√©n rutinas saludables y apoyo social.':nivel==='moderado'?'üëâ Suma respiraci√≥n diaria, l√≠mites amables y consulta si los s√≠ntomas persisten.':'‚ö†Ô∏è Busca orientaci√≥n profesional. Si hay ideas de hacerte da√±o o crisis, contacta servicios de emergencia o l√≠neas de ayuda.';const filled=answers.filter(v=>v>0).length;quizProg.style.width=`${(filled/Qs.length)*100}%`; }
    function renderQuiz(){quizList.innerHTML='';Qs.forEach((q,i)=>{const wrap=document.createElement('div');wrap.className='rounded-xl border p-3 card';wrap.innerHTML=`<p class="font-medium t-body">${i+1}. ${q}</p>`;const row=document.createElement('div');row.className='mt-2 flex flex-wrap gap-2 text-sm';[0,1,2,3].forEach(v=>{const b=document.createElement('button');b.className=`rounded-full border px-3 py-1 ${answers[i]===v?'bg-rose-400 text-white border-rose-400':'hover:bg-rose-50'}`;b.textContent=`${v} ${['Nunca','A veces','Frecuentemente','Casi siempre'][v]}`;b.onclick=()=>{answers[i]=v;localStorage.setItem('quiz-ans',JSON.stringify(answers));updateQuiz();renderQuiz();};row.appendChild(b);});wrap.appendChild(row);quizList.appendChild(wrap);});updateQuiz();}
    quizReset.onclick=()=>{answers=Array(Qs.length).fill(0);localStorage.setItem('quiz-ans',JSON.stringify(answers));renderQuiz();}; renderQuiz();

    /* ---------- H√°bitos ---------- */
    const habitsGrid=document.getElementById('habitsGrid'), habitsMeta=document.getElementById('habitsMeta'), habitsFill=document.getElementById('habitsFill');
    const days=['L','M','X','J','V','S','D'];
    let habits=JSON.parse(localStorage.getItem('habits')||'null')||[
      {id:'agua',name:'Agua (8 vasos)',week:Array(7).fill(false)},
      {id:'pasos',name:'10k pasos',week:Array(7).fill(false)},
      {id:'fuerza',name:'Fuerza (2x)',week:Array(7).fill(false)},
      {id:'descanso',name:'Dormir 7‚Äì9h',week:Array(7).fill(false)},
    ];
    function saveHabits(){localStorage.setItem('habits',JSON.stringify(habits));}
    function renderHabits(){habitsGrid.innerHTML='<div></div>'+days.map(d=>`<div class="text-center font-medium">${d}</div>`).join('');let total=0,done=0;habits.forEach(h=>{const name=document.createElement('div');name.textContent=h.name;name.className='truncate pr-2 text-sm t-body';habitsGrid.appendChild(name);h.week.forEach((v,idx)=>{total++;if(v) done++;const b=document.createElement('button');b.className=`aspect-square rounded-md border ${v?'bg-rose-400 text-white border-rose-400':'bg-white'}`;b.textContent=v?'‚úì':'';b.onclick=()=>{h.week[idx]=!h.week[idx];saveHabits();renderHabits();};habitsGrid.appendChild(b);});});const pct=Math.round((done/total)*100)||0;habitsMeta.textContent=`${pct}% completado`;habitsFill.style.width=`${pct}%`; }
    renderHabits();

    /* ---------- Peso + Chart ---------- */
    const wDate=document.getElementById('wDate'), wVal=document.getElementById('wVal'), wAdd=document.getElementById('wAdd'); const today=new Date().toISOString().slice(0,10); wDate.value=today; wVal.value=kg.value;
    let wData=JSON.parse(localStorage.getItem('weights')||'null')||[{date:today,weight:+kg.value}];
    const ctx=document.getElementById('wChart').getContext('2d'); function stroke(ctx){const g=ctx.createLinearGradient(0,0,0,240);g.addColorStop(0,'#fda4af');g.addColorStop(1,'#fecdd3');return g;}
    let chart=new Chart(ctx,{type:'line',data:{labels:wData.map(p=>p.date),datasets:[{label:'Peso (kg)',data:wData.map(p=>p.weight),borderWidth:2,tension:.35,borderColor:stroke(ctx),backgroundColor:'rgba(253,164,175,.15)',fill:true,pointRadius:2}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:false,grid:{color:'rgba(0,0,0,.06)'}},x:{grid:{display:false}}}}});
    function refreshChart(){chart.data.labels=wData.map(p=>p.date);chart.data.datasets[0].data=wData.map(p=>p.weight);chart.update();localStorage.setItem('weights',JSON.stringify(wData));}
    wAdd.onclick=()=>{if(!wDate.value||!wVal.value)return;const item={date:wDate.value,weight:+wVal.value};wData=wData.filter(p=>p.date!==item.date).concat(item).sort((a,b)=>a.date.localeCompare(b.date));refreshChart();};
  </script>
</body>
</html>
